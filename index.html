<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tagu-Taguan Chat</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    body {
      background-color: #f5f5f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .message-bubble {
      padding: 10px 14px;
      border-radius: 20px;
      max-width: 75%;
      position: relative;
      word-break: break-word;
    }
    .message-sent {
      background-color: #ff8b3d;
      color: white;
      margin-left: auto;
    }
    .message-received {
      background-color: #e0e0e0;
      color: black;
      margin-right: auto;
    }
    #reactionPicker {
      animation: fadeIn 0.2s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body class="flex flex-col h-screen">

  <!-- Header -->
  <header class="bg-white shadow p-4 flex justify-between items-center">
    <div class="text-xl font-bold text-[#ff8b3d] flex items-center gap-2">
      <i class="fa-solid fa-house"></i> Tagu-Taguan Chat
    </div>
    <button id="endChat" class="text-red-500 hover:text-red-700">
      <i class="fa-solid fa-phone-slash text-lg"></i>
    </button>
  </header>

  <!-- Chat container -->
  <main id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-2">
    <!-- Messages will appear here -->
  </main>

  <!-- Message input -->
  <footer class="bg-white p-4 flex gap-2 items-center">
    <input id="messageInput" type="text" placeholder="Type a message..." 
      class="flex-1 border border-gray-300 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#ff8b3d]">
    <button id="btnSend" class="bg-[#ff8b3d] hover:bg-[#ff7a1e] text-white p-3 rounded-full">
      <i class="fa-solid fa-paper-plane"></i>
    </button>
  </footer>

  <!-- Reaction Picker -->
  <div id="reactionPicker" class="hidden absolute bg-white shadow-lg rounded-full px-2 py-1 gap-2 flex z-50">
    <span class="reactionOption cursor-pointer">❤️</span>
    <span class="reactionOption cursor-pointer">😂</span>
    <span class="reactionOption cursor-pointer">😮</span>
    <span class="reactionOption cursor-pointer">👍</span>
    <span class="reactionOption cursor-pointer">🔥</span>
  </div>

  <script>
    const chatContainer = document.getElementById('chatContainer');
    const messageInput = document.getElementById('messageInput');
    const btnSend = document.getElementById('btnSend');
    const reactionPicker = document.getElementById('reactionPicker');
    let pressTimer, selectedMessageEl;

    // Send message
    btnSend.addEventListener('click', () => {
      const text = messageInput.value.trim();
      if (!text) return;
      addMessage(text, 'sent');
      messageInput.value = '';
    });

    // Add message to UI
    function addMessage(text, type) {
      const messageEl = document.createElement('div');
      messageEl.className = `message-bubble message-${type}`;
      messageEl.textContent = text;

      // Add long-press detection
      messageEl.addEventListener('mousedown', (e) => {
        pressTimer = setTimeout(() => {
          selectedMessageEl = messageEl;
          showReactionPicker(e.pageX, e.pageY);
        }, 500);
      });
      messageEl.addEventListener('mouseup', () => clearTimeout(pressTimer));
      messageEl.addEventListener('mouseleave', () => clearTimeout(pressTimer));

      chatContainer.appendChild(messageEl);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Show reaction picker
    function showReactionPicker(x, y) {
      reactionPicker.style.left = `${x}px`;
      reactionPicker.style.top = `${y - 40}px`;
      reactionPicker.classList.remove('hidden');
    }

    // Handle reaction click
    document.querySelectorAll('.reactionOption').forEach(opt => {
      opt.addEventListener('click', () => {
        const reaction = document.createElement('div');
        reaction.className = 'text-sm mt-1';
        reaction.textContent = opt.textContent;
        selectedMessageEl.appendChild(reaction);
        reactionPicker.classList.add('hidden');
      });
    });

    // Close reaction picker when clicking outside
    document.addEventListener('click', (e) => {
      if (!reactionPicker.contains(e.target)) {
        reactionPicker.classList.add('hidden');
      }
    });

    // End chat button
    document.getElementById('endChat').addEventListener('click', () => {
      chatContainer.innerHTML = '';
      messageInput.value = '';
      alert('Chat ended. Returning to nickname page...');
      // Here you would redirect to nickname page
    });
  </script>

</body>
</html>
